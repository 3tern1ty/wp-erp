!function($){"use strict";var e={initialize:function(){$("#postimagediv").on("click","#set-company-thumbnail",this.setCompanyLogo),$("#postimagediv").on("click","a.remove-logo",this.removeCompanyLogo),$(".erp-company-single").on("click","a#erp-company-new-location",this.newCompanyLocation),$(".erp-company-single").on("click","a.edit-location",this.editCompanyLocation),$(".erp-company-single").on("click","a.remove-location",this.removeCompanyLocation),$("body").on("change","select.erp-country-select",this.populateState),this.initDateField()},initDateField:function(){$(".erp-date-field").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0})},setCompanyLogo:function(e){e.preventDefault(),e.stopPropagation();var t;return t?void t.open():(t=wp.media({title:wpErp.upload_logo,button:{text:wpErp.set_logo}}),t.on("select",function(){var e=t.state().get("selection");e.map(function(e){e=e.toJSON();var t='<img src="'+e.url+'" alt="" />';t+='<input type="hidden" name="company_logo_id" value="'+e.id+'" />',t+='<a href="#" class="remove-logo">'+wpErp.remove_logo+"</a>",$(".inside","#postimagediv").html(t)})}),void t.open())},removeCompanyLogo:function(e){e.preventDefault();var t='<a href="#" id="set-company-thumbnail" class="thickbox">'+wpErp.upload_logo+"</a>";$(".inside","#postimagediv").html(t)},populateState:function(){if("undefined"==typeof wpErpCountries)return!1;var e=$(this),t=e.val(),o=e.closest(e.data("parent")),n='<option val="-1">-------------</option>';if(wpErpCountries[t]){var a="",i=wpErpCountries[t];for(var c in i)a=a+'<option value="'+c+'">'+i[c]+"</option>";o.find("select.erp-state-select").html($.isArray(wpErpCountries[t])?n:a)}else o.find("select.erp-state-select").html(n)},newCompanyLocation:function(e){e.preventDefault();var t=$(this);$.erpPopup({title:t.data("title"),button:wpErp.create,content:wp.template("erp-address")({data:null}),extraClass:"medium",onSubmit:function(e){wp.ajax.send({data:this.serializeObject(),success:function(){$("#company-locations").load(window.location.href+" #company-locations-inside"),e.closeModal()},error:function(e){alert(e)}})}})},editCompanyLocation:function(e){e.preventDefault();var t=$(this);$.erpPopup({title:wpErp.update_location,button:wpErp.update_location,content:wp.template("erp-address")(t.data("data")),extraClass:"medium",onReady:function(){$("li[data-selected]",this).each(function(){var e=$(this),t=e.data("selected");""!==t&&e.find("select").val(t)}),$("select.erp-country-select").change(),$("li[data-selected]",this).each(function(){var e=$(this),t=e.data("selected");""!==t&&e.find("select").val(t)})},onSubmit:function(e){wp.ajax.send({data:this.serializeObject(),success:function(){$("#company-locations").load(window.location.href+" #company-locations-inside"),e.closeModal()},error:function(e){alert(e)}})}})},removeCompanyLocation:function(e){e.preventDefault(),confirm(wpErpHr.confirm)&&wp.ajax.send("erp-delete-comp-location",{data:{id:$(this).data("id"),_wpnonce:wpErp.nonce},success:function(){$("#company-locations").load(window.location.href+" #company-locations-inside")}})}};$(function(){e.initialize()})}(jQuery,this),jQuery.fn.serializeObject=function(){var e={},t=this.serializeArray();return jQuery.each(t,function(){void 0!==e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e};
window.wperp=window.wperp||{},function(a){"use strict";wperp.template=function(b){var c={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"};return function(d){return _.template(a("#tmpl-"+b).html(),null,c)(d)}},wperp.scriptReload=function(b,c){wp.ajax.send({data:{action:b},success:function(b){a("#"+c).html(b.content)},error:function(a){alert(a)}})};var b={initialize:function(){a("#postimagediv").on("click","#set-company-thumbnail",this.setCompanyLogo),a("#postimagediv").on("click","a.remove-logo",this.removeCompanyLogo),a("body").on("click","a#erp-company-new-location",this.newCompanyLocation),a(".erp-company-single").on("click","a.edit-location",this.editCompanyLocation),a(".erp-company-single").on("click","a.remove-location",this.removeCompanyLocation),a("body").on("change","select.erp-country-select",this.populateState),a("body").on("erp-hr-after-new-location",this.afterNewLocation),a(".erp-hr-audit-log").on("click","a.erp-audit-log-view-changes",this.viewLogChanges),this.initFields()},afterNewLocation:function(b,c){wperp.scriptReload("erp_hr_script_reload","tmpl-erp-new-employee"),a(".erp-hr-location-drop-down").append('<option selected="selected" value="'+c.id+'">'+c.title+"</option>"),a(".erp-hr-location-drop-down").select2("val",c.id)},initFields:function(){a(".erp-date-field").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"-100:+0"}),a(".select2").select2({placeholder:a(this).attr("data-placeholder")})},viewLogChanges:function(b){b.preventDefault();var c=a(this);wp.ajax.send("erp_audit_log_view",{data:{id:c.data("id"),_wpnonce:wpErpHr.nonce},success:function(b){a.erpPopup({title:b.title,button:"",id:"erp-audit-log-popup",content:b.content,extraClass:"midium"})},error:function(a){alert(a)}})},setCompanyLogo:function(b){b.preventDefault(),b.stopPropagation();var c;return c?void c.open():(c=wp.media({title:wpErp.upload_logo,button:{text:wpErp.set_logo}}),c.on("select",function(){var b=c.state().get("selection");b.map(function(b){b=b.toJSON();var c='<img src="'+b.url+'" alt="" />';c+='<input type="hidden" name="company_logo_id" value="'+b.id+'" />',c+='<a href="#" class="remove-logo">'+wpErp.remove_logo+"</a>",a(".inside","#postimagediv").html(c)})}),void c.open())},removeCompanyLogo:function(b){b.preventDefault();var c='<a href="#" id="set-company-thumbnail" class="thickbox">'+wpErp.upload_logo+"</a>";a(".inside","#postimagediv").html(c)},populateState:function(){if("undefined"==typeof wpErpCountries)return!1;var b=a(this),c=b.val(),d=b.closest(b.data("parent")),e='<option val="-1">-------------</option>';if(wpErpCountries[c]){var f="",g=wpErpCountries[c];for(var h in g)f=f+'<option value="'+h+'">'+g[h]+"</option>";a.isArray(wpErpCountries[c])?d.find("select.erp-state-select").html(e):d.find("select.erp-state-select").html(f)}else d.find("select.erp-state-select").html(e)},newCompanyLocation:function(b){b.preventDefault();var c=a(this);a.erpPopup({title:c.data("title"),button:wpErp.create,id:"erp-new-location",content:wp.template("erp-address")({company_id:c.data("id")}).trim(),extraClass:"medium",onReady:function(){a(".select2").select2()},onSubmit:function(b){wp.ajax.send({data:this.serialize(),success:function(d){a("#company-locations").load(window.location.href+" #company-locations-inside"),c.hasClass("erp-add-new-location")||a("body").trigger("erp-hr-after-new-location",[d]),b.closeModal()},error:function(a){alert(a)}})}})},editCompanyLocation:function(b){b.preventDefault();var c=a(this);a.erpPopup({title:wpErp.update_location,button:wpErp.update_location,id:"erp-edit-location",content:wp.template("erp-address")(c.data("data")),extraClass:"medium",onReady:function(){a(".select2").select2(),a("li[data-selected]",this).each(function(){var b=a(this),c=b.data("selected");""!==c&&b.find("select").val(c)}),a("select.erp-country-select").change()},onSubmit:function(b){wp.ajax.send({data:this.serializeObject(),success:function(){a("#company-locations").load(window.location.href+" #company-locations-inside"),b.closeModal()},error:function(a){alert(a)}})}})},removeCompanyLocation:function(b){b.preventDefault(),confirm(wpErpHr.confirm)&&wp.ajax.send("erp-delete-comp-location",{data:{id:a(this).data("id"),_wpnonce:wpErp.nonce},success:function(){a("#company-locations").load(window.location.href+" #company-locations-inside")}})}};a(function(){b.initialize()})}(jQuery,this),jQuery.fn.serializeObject=function(){var a={},b=this.serializeArray();return jQuery.each(b,function(){void 0!==a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""}),a};